services:
    jar4-gateway:
        image: ${JAR4_IMAGE:-jar4:local}
        environment:
            HOME: /home/node
            TERM: xterm-256color
            JAR4_GATEWAY_TOKEN: ${JAR4_GATEWAY_TOKEN}
            CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY}
            CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY}
            CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE}
        volumes:
            - ${JAR4_CONFIG_DIR}:/home/node/.jar4
            - ${JAR4_WORKSPACE_DIR}:/home/node/jar4-workspace
        ports:
            - "${JAR4_GATEWAY_PORT:-18789}:18789"
            - "${JAR4_BRIDGE_PORT:-18790}:18790"
        init: true
        restart: unless-stopped
        command:
            [
                "node",
                "dist/index.js",
                "gateway",
                "--bind",
                "${JAR4_GATEWAY_BIND:-lan}",
                "--port",
                "${JAR4_GATEWAY_PORT:-18789}",
            ]

    jar4-cli:
        image: ${JAR4_IMAGE:-jar4:local}
        environment:
            HOME: /home/node
            TERM: xterm-256color
            BROWSER: echo
            CLAUDE_AI_SESSION_KEY: ${CLAUDE_AI_SESSION_KEY}
            CLAUDE_WEB_SESSION_KEY: ${CLAUDE_WEB_SESSION_KEY}
            CLAUDE_WEB_COOKIE: ${CLAUDE_WEB_COOKIE}
        volumes:
            - ${JAR4_CONFIG_DIR}:/home/node/.jar4
            - ${JAR4_WORKSPACE_DIR}:/home/node/jar4-workspace
        stdin_open: true
        tty: true
        init: true
        entrypoint: ["node", "dist/index.js"]
